// ============================================
// DIAGNOSTIC USERNAME - VERSION SIMPLE
// ============================================
// Copiez-collez TOUT ce code dans la console (F12)

console.log('%cüîç DIAGNOSTIC USERNAME', 'color: #00ffc3; font-size: 16px; font-weight: bold;');

// localStorage
const pendingLS = localStorage.getItem('pendingRegisterDataForGoogle');
const currentUserLS = localStorage.getItem('currentUser');
console.log('\nüì¶ LOCALSTORAGE:');
if (pendingLS) {
  const p = JSON.parse(pendingLS);
  console.log('  pendingRegisterDataForGoogle.username:', p.username || '‚ùå MANQUANT');
} else {
  console.log('  pendingRegisterDataForGoogle: ‚ùå NON TROUV√â');
}
if (currentUserLS) {
  const c = JSON.parse(currentUserLS);
  console.log('  currentUser.username:', c.username || '‚ùå MANQUANT');
} else {
  console.log('  currentUser: ‚ùå NON TROUV√â');
}

// sessionStorage
const pendingSS = sessionStorage.getItem('pendingRegisterDataForGoogle');
const currentUserSS = sessionStorage.getItem('currentUser');
console.log('\nüì¶ SESSIONSTORAGE:');
if (pendingSS) {
  const p = JSON.parse(pendingSS);
  console.log('  pendingRegisterDataForGoogle.username:', p.username || '‚ùå MANQUANT');
} else {
  console.log('  pendingRegisterDataForGoogle: ‚ùå NON TROUV√â');
}
if (currentUserSS) {
  const c = JSON.parse(currentUserSS);
  console.log('  currentUser.username:', c.username || '‚ùå MANQUANT');
} else {
  console.log('  currentUser: ‚ùå NON TROUV√â');
}

// window.currentUser
console.log('\nüåê WINDOW.CURRENTUSER:');
if (window.currentUser) {
  console.log('  username:', window.currentUser.username || '‚ùå MANQUANT');
  console.log('  email:', window.currentUser.email || '‚ùå MANQUANT');
  const isValid = window.currentUser.username && 
                  window.currentUser.username !== 'null' && 
                  window.currentUser.username !== '' &&
                  !window.currentUser.username.includes('@');
  console.log('  isValid:', isValid ? '‚úÖ' : '‚ùå');
} else {
  console.log('  ‚ùå N\'EXISTE PAS');
}

// window.pendingRegisterData
console.log('\nüåê WINDOW.PENDINGREGISTERDATA:');
if (window.pendingRegisterData) {
  console.log('  username:', window.pendingRegisterData.username || '‚ùå MANQUANT');
} else {
  console.log('  ‚ùå N\'EXISTE PAS');
}

// getUserDisplayName
console.log('\nüë§ GETUSERDISPLAYNAME:');
if (typeof getUserDisplayName === 'function' && window.currentUser) {
  const displayName = getUserDisplayName(window.currentUser);
  console.log('  R√©sultat:', displayName);
} else {
  console.log('  ‚ùå FONCTION NON DISPONIBLE');
}

// Bloc compte
console.log('\nüì± BLOC COMPTE:');
const accountName = document.getElementById('account-name');
if (accountName) {
  console.log('  Texte affich√©:', accountName.textContent);
} else {
  console.log('  ‚ùå √âL√âMENT NON TROUV√â');
}

// R√©sum√©
console.log('\nüìä R√âSUM√â:');
let found = false;
let source = '';
let value = '';

if (pendingLS) {
  const p = JSON.parse(pendingLS);
  if (p.username && p.username !== 'null' && p.username !== '' && !p.username.includes('@')) {
    found = true;
    source = 'localStorage';
    value = p.username;
  }
}

if (!found && pendingSS) {
  const p = JSON.parse(pendingSS);
  if (p.username && p.username !== 'null' && p.username !== '' && !p.username.includes('@')) {
    found = true;
    source = 'sessionStorage';
    value = p.username;
  }
}

if (!found && window.pendingRegisterData) {
  if (window.pendingRegisterData.username && 
      window.pendingRegisterData.username !== 'null' && 
      window.pendingRegisterData.username !== '' &&
      !window.pendingRegisterData.username.includes('@')) {
    found = true;
    source = 'window.pendingRegisterData';
    value = window.pendingRegisterData.username;
  }
}

if (!found && window.currentUser) {
  if (window.currentUser.username && 
      window.currentUser.username !== 'null' && 
      window.currentUser.username !== '' &&
      !window.currentUser.username.includes('@')) {
    found = true;
    source = 'window.currentUser';
    value = window.currentUser.username;
  }
}

if (found) {
  console.log('  ‚úÖ Username trouv√©:', value, 'dans', source);
} else {
  console.log('  ‚ùå Aucun username valide trouv√©');
}

if (accountName) {
  console.log('  üì± Affich√©:', accountName.textContent);
}

console.log('\n‚úÖ Diagnostic termin√©');
