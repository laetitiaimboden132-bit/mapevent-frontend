var result = (function() {
  let usernameFromForm = null;
  let source = '';
  
  try {
    const pendingData = localStorage.getItem('pendingRegisterDataForGoogle');
    if (pendingData) {
      const parsed = JSON.parse(pendingData);
      if (parsed.username && parsed.username !== 'null' && parsed.username !== '' && !parsed.username.includes('@')) {
        usernameFromForm = parsed.username;
        source = 'localStorage';
      }
    }
  } catch(e) {}
  
  if (!usernameFromForm) {
    try {
      const pendingData = sessionStorage.getItem('pendingRegisterDataForGoogle');
      if (pendingData) {
        const parsed = JSON.parse(pendingData);
        if (parsed.username && parsed.username !== 'null' && parsed.username !== '' && !parsed.username.includes('@')) {
          usernameFromForm = parsed.username;
          source = 'sessionStorage';
        }
      }
    } catch(e) {}
  }
  
  if (!usernameFromForm) {
    console.log('‚ùå Aucun username trouv√© dans localStorage ou sessionStorage');
    return { success: false, message: 'Aucun username trouv√©' };
  }
  
  console.log('‚úÖ Username trouv√©:', usernameFromForm, 'dans', source);
  
  if (!window.currentUser) {
    console.log('‚ùå window.currentUser n\'existe pas');
    return { success: false, message: 'window.currentUser n\'existe pas' };
  }
  
  window.currentUser.username = usernameFromForm;
  console.log('‚úÖ window.currentUser.username =', window.currentUser.username);
  
  try {
    const currentUserLS = localStorage.getItem('currentUser');
    if (currentUserLS) {
      const parsed = JSON.parse(currentUserLS);
      parsed.username = usernameFromForm;
      localStorage.setItem('currentUser', JSON.stringify(parsed));
      console.log('‚úÖ localStorage.currentUser.username mis √† jour');
    }
  } catch(e) {
    console.error('‚ùå Erreur sauvegarde localStorage:', e);
  }
  
  const accountName = document.getElementById('account-name');
  if (accountName) {
    const oldValue = accountName.textContent;
    accountName.textContent = usernameFromForm;
    console.log('‚úÖ Bloc compte mis √† jour:', oldValue, '‚Üí', usernameFromForm);
  } else {
    console.log('‚ùå account-name non trouv√© dans le DOM');
  }
  
  console.log('%c‚úÖ‚úÖ‚úÖ USERNAME CORRIG√â !', 'color: #22c55e; font-size: 16px; font-weight: bold;');
  console.log('   Username:', usernameFromForm);
  console.log('   window.currentUser.username:', window.currentUser.username);
  console.log('   Bloc compte:', accountName ? accountName.textContent : 'NON TROUV√â');
  
  return { success: true, username: usernameFromForm, source: source };
})();

console.log('üìä R√©sultat:', result);
